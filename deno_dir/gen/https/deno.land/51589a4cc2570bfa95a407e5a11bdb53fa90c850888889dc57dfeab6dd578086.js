import { Buffer } from "../buffer.ts";
import { pbkdf2Sync as pbkdf2 } from "./pbkdf2.ts";
const fixOpts = (opts) => {
    const out = { N: 16384, p: 1, r: 8, maxmem: 32 << 20 };
    if (!opts)
        return out;
    if (opts.N)
        out.N = opts.N;
    else if (opts.cost)
        out.N = opts.cost;
    if (opts.p)
        out.p = opts.p;
    else if (opts.parallelization)
        out.p = opts.parallelization;
    if (opts.r)
        out.r = opts.r;
    else if (opts.blockSize)
        out.r = opts.blockSize;
    if (opts.maxmem)
        out.maxmem = opts.maxmem;
    return out;
};
function blockxor(S, Si, D, Di, len) {
    let i = -1;
    while (++i < len)
        D[Di + i] ^= S[Si + i];
}
function arraycopy(src, srcPos, dest, destPos, length) {
    src.copy(dest, destPos, srcPos, srcPos + length);
}
const R = (a, b) => (a << b) | (a >>> (32 - b));
class ScryptRom {
    B;
    r;
    N;
    p;
    XY;
    V;
    B32;
    x;
    _X;
    constructor(b, r, N, p) {
        this.B = b;
        this.r = r;
        this.N = N;
        this.p = p;
        this.XY = Buffer.allocUnsafe(256 * r);
        this.V = Buffer.allocUnsafe(128 * r * N);
        this.B32 = new Int32Array(16);
        this.x = new Int32Array(16);
        this._X = Buffer.allocUnsafe(64);
    }
    run() {
        const p = this.p | 0;
        const r = this.r | 0;
        for (let i = 0; i < p; i++)
            this.scryptROMix(i, r);
        return this.B;
    }
    scryptROMix(i, r) {
        const blockStart = i * 128 * r;
        const offset = (2 * r - 1) * 64;
        const blockLen = 128 * r;
        const B = this.B;
        const N = this.N | 0;
        const V = this.V;
        const XY = this.XY;
        B.copy(XY, 0, blockStart, blockStart + blockLen);
        for (let i1 = 0; i1 < N; i1++) {
            XY.copy(V, i1 * blockLen, 0, blockLen);
            this.blockmix_salsa8(blockLen);
        }
        let j;
        for (let i2 = 0; i2 < N; i2++) {
            j = XY.readUInt32LE(offset) & (N - 1);
            blockxor(V, j * blockLen, XY, 0, blockLen);
            this.blockmix_salsa8(blockLen);
        }
        XY.copy(B, blockStart, 0, blockLen);
    }
    blockmix_salsa8(blockLen) {
        const BY = this.XY;
        const r = this.r;
        const _X = this._X;
        arraycopy(BY, (2 * r - 1) * 64, _X, 0, 64);
        let i;
        for (i = 0; i < 2 * r; i++) {
            blockxor(BY, i * 64, _X, 0, 64);
            this.salsa20_8();
            arraycopy(_X, 0, BY, blockLen + i * 64, 64);
        }
        for (i = 0; i < r; i++) {
            arraycopy(BY, blockLen + i * 2 * 64, BY, i * 64, 64);
            arraycopy(BY, blockLen + (i * 2 + 1) * 64, BY, (i + r) * 64, 64);
        }
    }
    salsa20_8() {
        const B32 = this.B32;
        const B = this._X;
        const x = this.x;
        let i;
        for (i = 0; i < 16; i++) {
            B32[i] = (B[i * 4 + 0] & 0xff) << 0;
            B32[i] |= (B[i * 4 + 1] & 0xff) << 8;
            B32[i] |= (B[i * 4 + 2] & 0xff) << 16;
            B32[i] |= (B[i * 4 + 3] & 0xff) << 24;
        }
        for (i = 0; i < 16; i++)
            x[i] = B32[i];
        for (i = 0; i < 4; i++) {
            x[4] ^= R(x[0] + x[12], 7);
            x[8] ^= R(x[4] + x[0], 9);
            x[12] ^= R(x[8] + x[4], 13);
            x[0] ^= R(x[12] + x[8], 18);
            x[9] ^= R(x[5] + x[1], 7);
            x[13] ^= R(x[9] + x[5], 9);
            x[1] ^= R(x[13] + x[9], 13);
            x[5] ^= R(x[1] + x[13], 18);
            x[14] ^= R(x[10] + x[6], 7);
            x[2] ^= R(x[14] + x[10], 9);
            x[6] ^= R(x[2] + x[14], 13);
            x[10] ^= R(x[6] + x[2], 18);
            x[3] ^= R(x[15] + x[11], 7);
            x[7] ^= R(x[3] + x[15], 9);
            x[11] ^= R(x[7] + x[3], 13);
            x[15] ^= R(x[11] + x[7], 18);
            x[1] ^= R(x[0] + x[3], 7);
            x[2] ^= R(x[1] + x[0], 9);
            x[3] ^= R(x[2] + x[1], 13);
            x[0] ^= R(x[3] + x[2], 18);
            x[6] ^= R(x[5] + x[4], 7);
            x[7] ^= R(x[6] + x[5], 9);
            x[4] ^= R(x[7] + x[6], 13);
            x[5] ^= R(x[4] + x[7], 18);
            x[11] ^= R(x[10] + x[9], 7);
            x[8] ^= R(x[11] + x[10], 9);
            x[9] ^= R(x[8] + x[11], 13);
            x[10] ^= R(x[9] + x[8], 18);
            x[12] ^= R(x[15] + x[14], 7);
            x[13] ^= R(x[12] + x[15], 9);
            x[14] ^= R(x[13] + x[12], 13);
            x[15] ^= R(x[14] + x[13], 18);
        }
        for (i = 0; i < 16; i++)
            B32[i] += x[i];
        let bi;
        for (i = 0; i < 16; i++) {
            bi = i * 4;
            B[bi + 0] = (B32[i] >> 0) & 0xff;
            B[bi + 1] = (B32[i] >> 8) & 0xff;
            B[bi + 2] = (B32[i] >> 16) & 0xff;
            B[bi + 3] = (B32[i] >> 24) & 0xff;
        }
    }
    clean() {
        this.XY.fill(0);
        this.V.fill(0);
        this._X.fill(0);
        this.B.fill(0);
        for (let i = 0; i < 16; i++) {
            this.B32[i] = 0;
            this.x[i] = 0;
        }
    }
}
export function scryptSync(password, salt, keylen, _opts) {
    const { N, r, p, maxmem } = fixOpts(_opts);
    const blen = p * 128 * r;
    if (32 * r * (N + 2) * 4 + blen > maxmem) {
        throw new Error("excedes max memory");
    }
    const b = pbkdf2(password, salt, 1, blen, "sha256");
    const scryptRom = new ScryptRom(b, r, N, p);
    const out = scryptRom.run();
    const fin = pbkdf2(password, out, 1, keylen, "sha256");
    scryptRom.clean();
    return fin;
}
export function scrypt(password, salt, keylen, _opts, cb) {
    if (!cb) {
        cb = _opts;
        _opts = null;
    }
    const { N, r, p, maxmem } = fixOpts(_opts);
    const blen = p * 128 * r;
    if (32 * r * (N + 2) * 4 + blen > maxmem) {
        throw new Error("excedes max memory");
    }
    try {
        const b = pbkdf2(password, salt, 1, blen, "sha256");
        const scryptRom = new ScryptRom(b, r, N, p);
        const out = scryptRom.run();
        const result = pbkdf2(password, out, 1, keylen, "sha256");
        scryptRom.clean();
        cb(null, result);
    }
    catch (err) {
        return cb(err);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyeXB0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic2NyeXB0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQXlCQSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBQ3RDLE9BQU8sRUFBRSxVQUFVLElBQUksTUFBTSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBYW5ELE1BQU0sT0FBTyxHQUFHLENBQUMsSUFBVyxFQUFFLEVBQUU7SUFDOUIsTUFBTSxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDO0lBQ3ZELElBQUksQ0FBQyxJQUFJO1FBQUUsT0FBTyxHQUFHLENBQUM7SUFFdEIsSUFBSSxJQUFJLENBQUMsQ0FBQztRQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQztTQUN0QixJQUFJLElBQUksQ0FBQyxJQUFJO1FBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO0lBRXRDLElBQUksSUFBSSxDQUFDLENBQUM7UUFBRSxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUM7U0FDdEIsSUFBSSxJQUFJLENBQUMsZUFBZTtRQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQztJQUU1RCxJQUFJLElBQUksQ0FBQyxDQUFDO1FBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDO1NBQ3RCLElBQUksSUFBSSxDQUFDLFNBQVM7UUFBRSxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7SUFFaEQsSUFBSSxJQUFJLENBQUMsTUFBTTtRQUFFLEdBQUcsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUUxQyxPQUFPLEdB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RSxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQ3ZCLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNwQyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDckMsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ3RDLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztTQUN2QztRQUVELEtBQUssQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsRUFBRTtZQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFdkMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDdEIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzNCLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUMxQixDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDNUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQzVCLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUMxQixDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDM0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQzVCLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUM1QixDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDNUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzVCLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUM1QixDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDNUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzVCLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUMzQixDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDNUIsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQzdCLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUMxQixDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDMUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQzNCLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUMzQixDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDMUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzFCLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUMzQixDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDM0IsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzVCLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUM1QixDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDNUIsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFD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RXBELE1BQU0sU0FBUyxHQUFHLElBQUksU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzVDLE1BQU0sR0FBRyxHQUFHLFNBQVMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUM1QixNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQzFELFNBQVMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNsQixFQUFFLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0tBQ2xCO0lBQUMsT0FBTyxHQUFZLEVBQUU7UUFDckIsT0FBTyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUM7S0FDaEI7QUFDSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTgtMjAyMiB0aGUgRGVubyBhdXRob3JzLiBBbGwgcmlnaHRzIHJlc2VydmVkLiBNSVQgbGljZW5zZS5cbi8qXG5NSVQgTGljZW5zZVxuXG5Db3B5cmlnaHQgKGMpIDIwMTggY3J5cHRvY29pbmpzXG5cblBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbm9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcblxuVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsXG5jb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG5JTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFXG5TT0ZUV0FSRS5cbiAqL1xuXG5pbXBvcnQgeyBCdWZmZXIgfSBmcm9tIFwiLi4vYnVmZmVyLnRzXCI7XG5pbXBvcnQgeyBwYmtkZjJTeW5jIGFzIHBia2RmMiB9IGZyb20gXCIuL3Bia2RmMi50c1wiO1xuaW1wb3J0IHsgSEFTSF9EQVRBIH0gZnJvbSBcIi4vdHlwZXMudHNcIjtcblxudHlwZSBPcHRzID0gUGFydGlhbDx7XG4gIE46IG51bWJlcjtcbiAgY29zdDogbnVtYmVyO1xuICBwOiBudW1iZXI7XG4gIHBhcmFsbGVsaXphdGlvbjogbnVtYmVyO1xuICByOiBudW1iZXI7XG4gIGJsb2NrU2l6ZTogbnVtYmVyO1xuICBtYXhtZW06IG51bWJlcjtcbn0+O1xuXG5jb25zdCBmaXhPcHRzID0gKG9wdHM/OiBPcHRzKSA9PiB7XG4gIGNvbnN0IG91dCA9IHsgTjogMTYzODQsIHA6IDEsIHI6IDgsIG1heG1lbTogMzIgPDwgMjAgfTtcbiAgaWYgKCFvcHRzKSByZXR1cm4gb3V0O1xuXG4gIGlmIChvcHRzLk4pIG91dC5OID0gb3B0cy5OO1xuICBlbHNlIGlmIChvcHRzLmNvc3QpIG91dC5OID0gb3B0cy5jb3N0O1xuXG4gIGlmIChvcHRzLnApIG91dC5wID0gb3B0cy5wO1xuICBlbHNlIGlmIChvcHRzLnBhcmFsbGVsaXphdGlvbikgb3V0LnAgPSBvcHRzLnBhcmFsbGVsaXphdGlvbjtcblxuICBpZiAob3B0cy5yKSBvdXQuciA9IG9wdHMucjtcbiAgZWxzZSBpZiAob3B0cy5ibG9ja1NpemUpIG91dC5yID0gb3B0cy5ibG9ja1NpemU7XG5cbiAgaWYgKG9wdHMubWF4bWVtKSBvdXQubWF4bWVtID0gb3B0cy5tYXhtZW07XG5cbiAgcmV0dXJuIG91dDtcbn07XG5cbmZ1bmN0aW9uIGJsb2NreG9yKFM6IEJ1ZmZlciwgU2k6IG51bWJlciwgRDogQnVmZmVyLCBEaTogbnVtYmVyLCBsZW46IG51bWJlcikge1xuICBsZXQgaSA9IC0xO1xuICB3aGlsZSAoKytpIDwgbGVuKSBEW0RpICsgaV0gXj0gU1tTaSArIGldO1xufVxuZnVuY3Rpb24gYXJyYXljb3B5KFxuICBzcmM6IEJ1ZmZlcixcbiAgc3JjUG9zOiBudW1iZXIsXG4gIGRlc3Q6IEJ1ZmZlcixcbiAgZGVzdFBvczogbnVtYmVyLFxuICBsZW5ndGg6IG51bWJlcixcbikge1xuICBzcmMuY29weShkZXN0LCBkZXN0UG9zLCBzcmNQb3MsIHNyY1BvcyArIGxlbmd0aCk7XG59XG5cbmNvbnN0IFIgPSAoYTogbnVtYmVyLCBiOiBudW1iZXIpID0+IChhIDw8IGIpIHwgKGEgPj4+ICgzMiAtIGIpKTtcblxuY2xhc3MgU2NyeXB0Um9tIHtcbiAgQjogQnVmZmVyO1xuICByOiBudW1iZXI7XG4gIE46IG51bWJlcjtcbiAgcDogbnVtYmVyO1xuICBYWTogQnVmZmVyO1xuICBWOiBCdWZmZXI7XG4gIEIzMjogSW50MzJBcnJheTtcbiAgeDogSW50MzJBcnJheTtcbiAgX1g6IEJ1ZmZlcjtcbiAgY29uc3RydWN0b3IoYjogQnVmZmVyLCByOiBudW1iZXIsIE46IG51bWJlciwgcDogbnVtYmVyKSB7XG4gICAgdGhpcy5CID0gYjtcbiAgICB0aGlzLnIgPSByO1xuICAgIHRoaXMuTiA9IE47XG4gICAgdGhpcy5wID0gcDtcbiAgICB0aGlzLlhZID0gQnVmZmVyLmFsbG9jVW5zYWZlKDI1NiAqIHIpO1xuICAgIHRoaXMuViA9IEJ1ZmZlci5hbGxvY1Vuc2FmZSgxMjggKiByICogTik7XG4gICAgdGhpcy5CMzIgPSBuZXcgSW50MzJBcnJheSgxNik7IC8vIHNhbHNhMjBfOFxuICAgIHRoaXMueCA9IG5ldyBJbnQzMkFycmF5KDE2KTsgLy8gc2Fsc2EyMF84XG4gICAgdGhpcy5fWCA9IEJ1ZmZlci5hbGxvY1Vuc2FmZSg2NCk7IC8vIGJsb2NrbWl4X3NhbHNhOFxuICB9XG5cbiAgcnVuKCkge1xuICAgIGNvbnN0IHAgPSB0aGlzLnAgfCAwO1xuICAgIGNvbnN0IHIgPSB0aGlzLnIgfCAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcDsgaSsrKSB0aGlzLnNjcnlwdFJPTWl4KGksIHIpO1xuXG4gICAgcmV0dXJuIHRoaXMuQjtcbiAgfVxuXG4gIHNjcnlwdFJPTWl4KGk6IG51bWJlciwgcjogbnVtYmVyKSB7XG4gICAgY29uc3QgYmxvY2tTdGFydCA9IGkgKiAxMjggKiByO1xuICAgIGNvbnN0IG9mZnNldCA9ICgyICogciAtIDEpICogNjQ7XG4gICAgY29uc3QgYmxvY2tMZW4gPSAxMjggKiByO1xuICAgIGNvbnN0IEIgPSB0aGlzLkI7XG4gICAgY29uc3QgTiA9IHRoaXMuTiB8IDA7XG4gICAgY29uc3QgViA9IHRoaXMuVjtcbiAgICBjb25zdCBYWSA9IHRoaXMuWFk7XG4gICAgQi5jb3B5KFhZLCAwLCBibG9ja1N0YXJ0LCBibG9ja1N0YXJ0ICsgYmxvY2tMZW4pO1xuICAgIGZvciAobGV0IGkxID0gMDsgaTEgPCBOOyBpMSsrKSB7XG4gICAgICBYWS5jb3B5KFYsIGkxICogYmxvY2tMZW4sIDAsIGJsb2NrTGVuKTtcbiAgICAgIHRoaXMuYmxvY2ttaXhfc2Fsc2E4KGJsb2NrTGVuKTtcbiAgICB9XG5cbiAgICBsZXQgajogbnVtYmVyO1xuICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCBOOyBpMisrKSB7XG4gICAgICBqID0gWFkucmVhZFVJbnQzMkxFKG9mZnNldCkgJiAoTiAtIDEpO1xuICAgICAgYmxvY2t4b3IoViwgaiAqIGJsb2NrTGVuLCBYWSwgMCwgYmxvY2tMZW4pO1xuICAgICAgdGhpcy5ibG9ja21peF9zYWxzYTgoYmxvY2tMZW4pO1xuICAgIH1cbiAgICBYWS5jb3B5KEIsIGJsb2NrU3RhcnQsIDAsIGJsb2NrTGVuKTtcbiAgfVxuXG4gIGJsb2NrbWl4X3NhbHNhOChibG9ja0xlbjogbnVtYmVyKSB7XG4gICAgY29uc3QgQlkgPSB0aGlzLlhZO1xuICAgIGNvbnN0IHIgPSB0aGlzLnI7XG4gICAgY29uc3QgX1ggPSB0aGlzLl9YO1xuICAgIGFycmF5Y29weShCWSwgKDIgKiByIC0gMSkgKiA2NCwgX1gsIDAsIDY0KTtcbiAgICBsZXQgaTtcbiAgICBmb3IgKGkgPSAwOyBpIDwgMiAqIHI7IGkrKykge1xuICAgICAgYmxvY2t4b3IoQlksIGkgKiA2NCwgX1gsIDAsIDY0KTtcbiAgICAgIHRoaXMuc2Fsc2EyMF84KCk7XG4gICAgICBhcnJheWNvcHkoX1gsIDAsIEJZLCBibG9ja0xlbiArIGkgKiA2NCwgNjQpO1xuICAgIH1cbiAgICBmb3IgKGkgPSAwOyBpIDwgcjsgaSsrKSB7XG4gICAgICBhcnJheWNvcHkoQlksIGJsb2NrTGVuICsgaSAqIDIgKiA2NCwgQlksIGkgKiA2NCwgNjQpO1xuICAgICAgYXJyYXljb3B5KEJZLCBibG9ja0xlbiArIChpICogMiArIDEpICogNjQsIEJZLCAoaSArIHIpICogNjQsIDY0KTtcbiAgICB9XG4gIH1cblxuICBzYWxzYTIwXzgoKSB7XG4gICAgY29uc3QgQjMyID0gdGhpcy5CMzI7XG4gICAgY29uc3QgQiA9IHRoaXMuX1g7XG4gICAgY29uc3QgeCA9IHRoaXMueDtcblxuICAgIGxldCBpO1xuICAgIGZvciAoaSA9IDA7IGkgPCAxNjsgaSsrKSB7XG4gICAgICBCMzJbaV0gPSAoQltpICogNCArIDBdICYgMHhmZikgPDwgMDtcbiAgICAgIEIzMltpXSB8PSAoQltpICogNCArIDFdICYgMHhmZikgPDwgODtcbiAgICAgIEIzMltpXSB8PSAoQltpICogNCArIDJdICYgMHhmZikgPDwgMTY7XG4gICAgICBCMzJbaV0gfD0gKEJbaSAqIDQgKyAzXSAmIDB4ZmYpIDw8IDI0O1xuICAgIH1cblxuICAgIGZvciAoaSA9IDA7IGkgPCAxNjsgaSsrKSB4W2ldID0gQjMyW2ldO1xuXG4gICAgZm9yIChpID0gMDsgaSA8IDQ7IGkrKykge1xuICAgICAgeFs0XSBePSBSKHhbMF0gKyB4WzEyXSwgNyk7XG4gICAgICB4WzhdIF49IFIoeFs0XSArIHhbMF0sIDkpO1xuICAgICAgeFsxMl0gXj0gUih4WzhdICsgeFs0XSwgMTMpO1xuICAgICAgeFswXSBePSBSKHhbMTJdICsgeFs4XSwgMTgpO1xuICAgICAgeFs5XSBePSBSKHhbNV0gKyB4WzFdLCA3KTtcbiAgICAgIHhbMTNdIF49IFIoeFs5XSArIHhbNV0sIDkpO1xuICAgICAgeFsxXSBePSBSKHhbMTNdICsgeFs5XSwgMTMpO1xuICAgICAgeFs1XSBePSBSKHhbMV0gKyB4WzEzXSwgMTgpO1xuICAgICAgeFsxNF0gXj0gUih4WzEwXSArIHhbNl0sIDcpO1xuICAgICAgeFsyXSBePSBSKHhbMTRdICsgeFsxMF0sIDkpO1xuICAgICAgeFs2XSBePSBSKHhbMl0gKyB4WzE0XSwgMTMpO1xuICAgICAgeFsxMF0gXj0gUih4WzZdICsgeFsyXSwgMTgpO1xuICAgICAgeFszXSBePSBSKHhbMTVdICsgeFsxMV0sIDcpO1xuICAgICAgeFs3XSBePSBSKHhbM10gKyB4WzE1XSwgOSk7XG4gICAgICB4WzExXSBePSBSKHhbN10gKyB4WzNdLCAxMyk7XG4gICAgICB4WzE1XSBePSBSKHhbMTFdICsgeFs3XSwgMTgpO1xuICAgICAgeFsxXSBePSBSKHhbMF0gKyB4WzNdLCA3KTtcbiAgICAgIHhbMl0gXj0gUih4WzFdICsgeFswXSwgOSk7XG4gICAgICB4WzNdIF49IFIoeFsyXSArIHhbMV0sIDEzKTtcbiAgICAgIHhbMF0gXj0gUih4WzNdICsgeFsyXSwgMTgpO1xuICAgICAgeFs2XSBePSBSKHhbNV0gKyB4WzRdLCA3KTtcbiAgICAgIHhbN10gXj0gUih4WzZdICsgeFs1XSwgOSk7XG4gICAgICB4WzRdIF49IFIoeFs3XSArIHhbNl0sIDEzKTtcbiAgICAgIHhbNV0gXj0gUih4WzRdICsgeFs3XSwgMTgpO1xuICAgICAgeFsxMV0gXj0gUih4WzEwXSArIHhbOV0sIDcpO1xuICAgICAgeFs4XSBePSBSKHhbMTFdICsgeFsxMF0sIDkpO1xuICAgICAgeFs5XSBePSBSKHhbOF0gKyB4WzExXSwgMTMpO1xuICAgICAgeFsxMF0gXj0gUih4WzldICsgeFs4XSwgMTgpO1xuICAgICAgeFsxMl0gXj0gUih4WzE1XSArIHhbMTRdLCA3KTtcbiAgICAgIHhbMTNdIF49IFIoeFsxMl0gKyB4WzE1XSwgOSk7XG4gICAgICB4WzE0XSBePSBSKHhbMTNdICsgeFsxMl0sIDEzKTtcbiAgICAgIHhbMTVdIF49IFIoeFsxNF0gKyB4WzEzXSwgMTgpO1xuICAgIH1cbiAgICBmb3IgKGkgPSAwOyBpIDwgMTY7IGkrKykgQjMyW2ldICs9IHhbaV07XG5cbiAgICBsZXQgYmk7XG5cbiAgICBmb3IgKGkgPSAwOyBpIDwgMTY7IGkrKykge1xuICAgICAgYmkgPSBpICogNDtcbiAgICAgIEJbYmkgKyAwXSA9IChCMzJbaV0gPj4gMCkgJiAweGZmO1xuICAgICAgQltiaSArIDFdID0gKEIzMltpXSA+PiA4KSAmIDB4ZmY7XG4gICAgICBCW2JpICsgMl0gPSAoQjMyW2ldID4+IDE2KSAmIDB4ZmY7XG4gICAgICBCW2JpICsgM10gPSAoQjMyW2ldID4+IDI0KSAmIDB4ZmY7XG4gICAgfVxuICB9XG5cbiAgY2xlYW4oKSB7XG4gICAgdGhpcy5YWS5maWxsKDApO1xuICAgIHRoaXMuVi5maWxsKDApO1xuICAgIHRoaXMuX1guZmlsbCgwKTtcbiAgICB0aGlzLkIuZmlsbCgwKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDE2OyBpKyspIHtcbiAgICAgIHRoaXMuQjMyW2ldID0gMDtcbiAgICAgIHRoaXMueFtpXSA9IDA7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzY3J5cHRTeW5jKFxuICBwYXNzd29yZDogSEFTSF9EQVRBLFxuICBzYWx0OiBIQVNIX0RBVEEsXG4gIGtleWxlbjogbnVtYmVyLFxuICBfb3B0cz86IE9wdHMsXG4pOiBCdWZmZXIge1xuICBjb25zdCB7IE4sIHIsIHAsIG1heG1lbSB9ID0gZml4T3B0cyhfb3B0cyk7XG5cbiAgY29uc3QgYmxlbiA9IHAgKiAxMjggKiByO1xuXG4gIGlmICgzMiAqIHIgKiAoTiArIDIpICogNCArIGJsZW4gPiBtYXhtZW0pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJleGNlZGVzIG1heCBtZW1vcnlcIik7XG4gIH1cblxuICBjb25zdCBiID0gcGJrZGYyKHBhc3N3b3JkLCBzYWx0LCAxLCBibGVuLCBcInNoYTI1NlwiKTtcblxuICBjb25zdCBzY3J5cHRSb20gPSBuZXcgU2NyeXB0Um9tKGIsIHIsIE4sIHApO1xuICBjb25zdCBvdXQgPSBzY3J5cHRSb20ucnVuKCk7XG5cbiAgY29uc3QgZmluID0gcGJrZGYyKHBhc3N3b3JkLCBvdXQsIDEsIGtleWxlbiwgXCJzaGEyNTZcIik7XG4gIHNjcnlwdFJvbS5jbGVhbigpO1xuICByZXR1cm4gZmluO1xufVxuXG50eXBlIENhbGxiYWNrID0gKGVycjogdW5rbm93biwgcmVzdWx0PzogQnVmZmVyKSA9PiB2b2lkO1xuXG5leHBvcnQgZnVuY3Rpb24gc2NyeXB0KFxuICBwYXNzd29yZDogSEFTSF9EQVRBLFxuICBzYWx0OiBIQVNIX0RBVEEsXG4gIGtleWxlbjogbnVtYmVyLFxuICBfb3B0czogT3B0cyB8IG51bGwgfCBDYWxsYmFjayxcbiAgY2I/OiBDYWxsYmFjayxcbikge1xuICBpZiAoIWNiKSB7XG4gICAgY2IgPSBfb3B0cyBhcyBDYWxsYmFjaztcbiAgICBfb3B0cyA9IG51bGw7XG4gIH1cbiAgY29uc3QgeyBOLCByLCBwLCBtYXhtZW0gfSA9IGZpeE9wdHMoX29wdHMgYXMgT3B0cyk7XG5cbiAgY29uc3QgYmxlbiA9IHAgKiAxMjggKiByO1xuICBpZiAoMzIgKiByICogKE4gKyAyKSAqIDQgKyBibGVuID4gbWF4bWVtKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiZXhjZWRlcyBtYXggbWVtb3J5XCIpO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBiID0gcGJrZGYyKHBhc3N3b3JkLCBzYWx0LCAxLCBibGVuLCBcInNoYTI1NlwiKTtcblxuICAgIGNvbnN0IHNjcnlwdFJvbSA9IG5ldyBTY3J5cHRSb20oYiwgciwgTiwgcCk7XG4gICAgY29uc3Qgb3V0ID0gc2NyeXB0Um9tLnJ1bigpO1xuICAgIGNvbnN0IHJlc3VsdCA9IHBia2RmMihwYXNzd29yZCwgb3V0LCAxLCBrZXlsZW4sIFwic2hhMjU2XCIpO1xuICAgIHNjcnlwdFJvbS5jbGVhbigpO1xuICAgIGNiKG51bGwsIHJlc3VsdCk7XG4gIH0gY2F0Y2ggKGVycjogdW5rbm93bikge1xuICAgIHJldHVybiBjYihlcnIpO1xuICB9XG59XG4iXX0=