function getLengths(b64) {
    const len = b64.length;
    let validLen = b64.indexOf("=");
    if (validLen === -1) {
        validLen = len;
    }
    const placeHoldersLen = validLen === len ? 0 : 4 - (validLen % 4);
    return [validLen, placeHoldersLen];
}
export function init(lookup, revLookup, urlsafe = false) {
    function _byteLength(validLen, placeHoldersLen) {
        return Math.floor(((validLen + placeHoldersLen) * 3) / 4 - placeHoldersLen);
    }
    function tripletToBase64(num) {
        return (lookup[(num >> 18) & 0x3f] +
            lookup[(num >> 12) & 0x3f] +
            lookup[(num >> 6) & 0x3f] +
            lookup[num & 0x3f]);
    }
    function encodeChunk(buf, start, end) {
        const out = new Array((end - start) / 3);
        for (let i = start, curTriplet = 0; i < end; i += 3) {
            out[curTriplet++] = tripletToBase64((buf[i] << 16) + (buf[i + 1] << 8) + buf[i + 2]);
        }
        return out.join("");
    }
    return {
        byteLength(b64) {
            return _byteLength.apply(null, getLengths(b64));
        },
        toUint8Array(b64) {
            const [validLen, placeHoldersLen] = getLengths(b64);
            const buf = new Uint8Array(_byteLength(validLen, placeHoldersLen));
            const len = placeHoldersLen ? validLen - 4 : validLen;
            let tmp;
            let curByte = 0;
            let i;
            for (i = 0; i < len; i += 4) {
                tmp = (revLookup[b64.charCodeAt(i)] << 18) |
                    (revLookup[b64.charCodeAt(i + 1)] << 12) |
                    (revLookup[b64.charCodeAt(i + 2)] << 6) |
                    revLookup[b64.charCodeAt(i + 3)];
                buf[curByte++] = (tmp >> 16) & 0xff;
                buf[curByte++] = (tmp >> 8) & 0xff;
                buf[curByte++] = tmp & 0xff;
            }
            if (placeHoldersLen === 2) {
                tmp = (revLookup[b64.charCodeAt(i)] << 2) |
                    (revLookup[b64.charCodeAt(i + 1)] >> 4);
                buf[curByte++] = tmp & 0xff;
            }
            else if (placeHoldersLen === 1) {
                tmp = (revLookup[b64.charCodeAt(i)] << 10) |
                    (revLookup[b64.charCodeAt(i + 1)] << 4) |
                    (revLookup[b64.charCodeAt(i + 2)] >> 2);
                buf[curByte++] = (tmp >> 8) & 0xff;
                buf[curByte++] = tmp & 0xff;
            }
            return buf;
        },
        fromUint8Array(buf) {
            const maxChunkLength = 16383;
            const len = buf.length;
            const extraBytes = len % 3;
            const len2 = len - extraBytes;
            const parts = new Array(Math.ceil(len2 / maxChunkLength) + (extraBytes ? 1 : 0));
            let curChunk = 0;
            let chunkEnd;
            for (let i = 0; i < len2; i += maxChunkLength) {
                chunkEnd = i + maxChunkLength;
                parts[curChunk++] = encodeChunk(buf, i, chunkEnd > len2 ? len2 : chunkEnd);
            }
            let tmp;
            if (extraBytes === 1) {
                tmp = buf[len2];
                parts[curChunk] = lookup[tmp >> 2] + lookup[(tmp << 4) & 0x3f];
                if (!urlsafe)
                    parts[curChunk] += "==";
            }
            else if (extraBytes === 2) {
                tmp = (buf[len2] << 8) | (buf[len2 + 1] & 0xff);
                parts[curChunk] = lookup[tmp >> 10] +
                    lookup[(tmp >> 4) & 0x3f] +
                    lookup[(tmp << 2) & 0x3f];
                if (!urlsafe)
                    parts[curChunk] += "=";
            }
            return parts.join("");
        },
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImJhc2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsU0FBUyxVQUFVLENBQUMsR0FBVztJQUM3QixNQUFNLEdBQUcsR0FBVyxHQUFHLENBQUMsTUFBTSxDQUFDO0lBUS9CLElBQUksUUFBUSxHQUFXLEdBQUcsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7SUFFeEMsSUFBSSxRQUFRLEtBQUssQ0FBQyxDQUFDLEVBQUU7UUFDbkIsUUFBUSxHQUFHLEdBQUcsQ0FBQztLQUNoQjtJQUVELE1BQU0sZUFBZSxHQUFXLFFBQVEsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBRTFFLE9BQU8sQ0FBQyxRQUFRLEVBQUUsZUFBZSxDQUFDLENBQUM7QUFDckMsQ0FBQztBQUVELE1BQU0sVUFBVSxJQUFJLENBQ2xCLE1BQWdCLEVBQ2hCLFNBQW1CLEVBQ25CLFVBQW1CLEtBQUs7SUFFeEIsU0FBUyxXQUFXLENBQUMsUUFBZ0IsRUFBRSxlQUF1QjtRQUM1RCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFFBQVEsR0FBRyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsZUFBZSxDQUFDLENBQUM7SUFDOUUsQ0FBQztJQUVELFNBQVMsZUFBZSxDQUFDLEdBQVc7UUFDbEMsT0FBTyxDQUNMLE1BQU0sQ0FBQyxDQUFDLEdBQUcsSUFBSSxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUM7WUFDMUIsTUFBTSxDQUFDLENBQUMsR0FBRyxJQUFJLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQztZQUMxQixNQUFNLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDO1lBQ3pCLE1BQU0sQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLENB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LENBQUM7QUFDSixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gZ2V0TGVuZ3RocyhiNjQ6IHN0cmluZyk6IFtudW1iZXIsIG51bWJlcl0ge1xuICBjb25zdCBsZW46IG51bWJlciA9IGI2NC5sZW5ndGg7XG5cbiAgLy8gaWYgKGxlbiAlIDQgPiAwKSB7XG4gIC8vICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkludmFsaWQgc3RyaW5nLiBMZW5ndGggbXVzdCBiZSBhIG11bHRpcGxlIG9mIDRcIik7XG4gIC8vIH1cblxuICAvLyBUcmltIG9mZiBleHRyYSBieXRlcyBhZnRlciBwbGFjZWhvbGRlciBieXRlcyBhcmUgZm91bmRcbiAgLy8gU2VlOiBodHRwczovL2dpdGh1Yi5jb20vYmVhdGdhbW1pdC9iYXNlNjQtanMvaXNzdWVzLzQyXG4gIGxldCB2YWxpZExlbjogbnVtYmVyID0gYjY0LmluZGV4T2YoXCI9XCIpO1xuXG4gIGlmICh2YWxpZExlbiA9PT0gLTEpIHtcbiAgICB2YWxpZExlbiA9IGxlbjtcbiAgfVxuXG4gIGNvbnN0IHBsYWNlSG9sZGVyc0xlbjogbnVtYmVyID0gdmFsaWRMZW4gPT09IGxlbiA/IDAgOiA0IC0gKHZhbGlkTGVuICUgNCk7XG5cbiAgcmV0dXJuIFt2YWxpZExlbiwgcGxhY2VIb2xkZXJzTGVuXTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGluaXQoXG4gIGxvb2t1cDogc3RyaW5nW10sXG4gIHJldkxvb2t1cDogbnVtYmVyW10sXG4gIHVybHNhZmU6IGJvb2xlYW4gPSBmYWxzZSxcbikge1xuICBmdW5jdGlvbiBfYnl0ZUxlbmd0aCh2YWxpZExlbjogbnVtYmVyLCBwbGFjZUhvbGRlcnNMZW46IG51bWJlcik6IG51bWJlciB7XG4gICAgcmV0dXJuIE1hdGguZmxvb3IoKCh2YWxpZExlbiArIHBsYWNlSG9sZGVyc0xlbikgKiAzKSAvIDQgLSBwbGFjZUhvbGRlcnNMZW4pO1xuICB9XG5cbiAgZnVuY3Rpb24gdHJpcGxldFRvQmFzZTY0KG51bTogbnVtYmVyKTogc3RyaW5nIHtcbiAgICByZXR1cm4gKFxuICAgICAgbG9va3VwWyhudW0gPj4gMTgpICYgMHgzZl0gK1xuICAgICAgbG9va3VwWyhudW0gPj4gMTIpICYgMHgzZl0gK1xuICAgICAgbG9va3VwWyhudW0gPj4gNikgJiAweDNmXSArXG4gICAgICBsb29rdXBbbnVtICYgMHgzZl1cbiAgICApO1xuICB9XG5cbiAgZnVuY3Rpb24gZW5jb2RlQ2h1bmsoYnVmOiBVaW50OEFycmF5LCBzdGFydDogbnVtYmVyLCBlbmQ6IG51bWJlcik6IHN0cmluZyB7XG4gICAgY29uc3Qgb3V0OiBzdHJpbmdbXSA9IG5ldyBBcnJheSgoZW5kIC0gc3RhcnQpIC8gMyk7XG5cbiAgICBmb3IgKGxldCBpOiBudW1iZXIgPSBzdGFydCwgY3VyVHJpcGxldDogbnVtYmVyID0gMDsgaSA8IGVuZDsgaSArPSAzKSB7XG4gICAgICBvdXRbY3VyVHJpcGxldCsrXSA9IHRyaXBsZXRUb0Jhc2U2NChcbiAgICAgICAgKGJ1ZltpXSA8PCAxNikgKyAoYnVmW2kgKyAxXSA8PCA4KSArIGJ1ZltpICsgMl0sXG4gICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiBvdXQuam9pbihcIlwiKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgLy8gYmFzZTY0IGlzIDQvMyArIHVwIHRvIHR3byBjaGFyYWN0ZXJzIG9mIHRoZSBvcmlnaW5hbCBkYXRhXG4gICAgYnl0ZUxlbmd0aChiNjQ6IHN0cmluZyk6IG51bWJlciB7XG4gICAgICByZXR1cm4gX2J5dGVMZW5ndGguYXBwbHkobnVsbCwgZ2V0TGVuZ3RocyhiNjQpKTtcbiAgICB9LFxuICAgIHRvVWludDhBcnJheShiNjQ6IHN0cmluZyk6IFVpbnQ4QXJyYXkge1xuICAgICAgY29uc3QgW3ZhbGlkTGVuLCBwbGFjZUhvbGRlcnNMZW5dOiBudW1iZXJbXSA9IGdldExlbmd0aHMoYjY0KTtcblxuICAgICAgY29uc3QgYnVmID0gbmV3IFVpbnQ4QXJyYXkoX2J5dGVMZW5ndGgodmFsaWRMZW4sIHBsYWNlSG9sZGVyc0xlbikpO1xuXG4gICAgICAvLyBJZiB0aGVyZSBhcmUgcGxhY2Vob2xkZXJzLCBvbmx5IGdldCB1cCB0byB0aGUgbGFzdCBjb21wbGV0ZSA0IGNoYXJzXG4gICAgICBjb25zdCBsZW46IG51bWJlciA9IHBsYWNlSG9sZGVyc0xlbiA/IHZhbGlkTGVuIC0gNCA6IHZhbGlkTGVuO1xuXG4gICAgICBsZXQgdG1wOiBudW1iZXI7XG4gICAgICBsZXQgY3VyQnl0ZTogbnVtYmVyID0gMDtcbiAgICAgIGxldCBpOiBudW1iZXI7XG5cbiAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkgKz0gNCkge1xuICAgICAgICB0bXAgPSAocmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkpXSA8PCAxOCkgfFxuICAgICAgICAgIChyZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaSArIDEpXSA8PCAxMikgfFxuICAgICAgICAgIChyZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaSArIDIpXSA8PCA2KSB8XG4gICAgICAgICAgcmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkgKyAzKV07XG4gICAgICAgIGJ1ZltjdXJCeXRlKytdID0gKHRtcCA+PiAxNikgJiAweGZmO1xuICAgICAgICBidWZbY3VyQnl0ZSsrXSA9ICh0bXAgPj4gOCkgJiAweGZmO1xuICAgICAgICBidWZbY3VyQnl0ZSsrXSA9IHRtcCAmIDB4ZmY7XG4gICAgICB9XG5cbiAgICAgIGlmIChwbGFjZUhvbGRlcnNMZW4gPT09IDIpIHtcbiAgICAgICAgdG1wID0gKHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpKV0gPDwgMikgfFxuICAgICAgICAgIChyZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaSArIDEpXSA+PiA0KTtcbiAgICAgICAgYnVmW2N1ckJ5dGUrK10gPSB0bXAgJiAweGZmO1xuICAgICAgfSBlbHNlIGlmIChwbGFjZUhvbGRlcnNMZW4gPT09IDEpIHtcbiAgICAgICAgdG1wID0gKHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpKV0gPDwgMTApIHxcbiAgICAgICAgICAocmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkgKyAxKV0gPDwgNCkgfFxuICAgICAgICAgIChyZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaSArIDIpXSA+PiAyKTtcbiAgICAgICAgYnVmW2N1ckJ5dGUrK10gPSAodG1wID4+IDgpICYgMHhmZjtcbiAgICAgICAgYnVmW2N1ckJ5dGUrK10gPSB0bXAgJiAweGZmO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gYnVmO1xuICAgIH0sXG4gICAgZnJvbVVpbnQ4QXJyYXkoYnVmOiBVaW50OEFycmF5KTogc3RyaW5nIHtcbiAgICAgIGNvbnN0IG1heENodW5rTGVuZ3RoOiBudW1iZXIgPSAxNjM4MzsgLy8gTXVzdCBiZSBtdWx0aXBsZSBvZiAzXG5cbiAgICAgIGNvbnN0IGxlbjogbnVtYmVyID0gYnVmLmxlbmd0aDtcblxuICAgICAgY29uc3QgZXh0cmFCeXRlczogbnVtYmVyID0gbGVuICUgMzsgLy8gSWYgd2UgaGF2ZSAxIGJ5dGUgbGVmdCwgcGFkIDIgYnl0ZXNcblxuICAgICAgY29uc3QgbGVuMjogbnVtYmVyID0gbGVuIC0gZXh0cmFCeXRlcztcblxuICAgICAgY29uc3QgcGFydHM6IHN0cmluZ1tdID0gbmV3IEFycmF5KFxuICAgICAgICBNYXRoLmNlaWwobGVuMiAvIG1heENodW5rTGVuZ3RoKSArIChleHRyYUJ5dGVzID8gMSA6IDApLFxuICAgICAgKTtcblxuICAgICAgbGV0IGN1ckNodW5rOiBudW1iZXIgPSAwO1xuICAgICAgbGV0IGNodW5rRW5kOiBudW1iZXI7XG5cbiAgICAgIC8vIEdvIHRocm91Z2ggdGhlIGFycmF5IGV2ZXJ5IHRocmVlIGJ5dGVzLCB3ZSdsbCBkZWFsIHdpdGggdHJhaWxpbmcgc3R1ZmYgbGF0ZXJcbiAgICAgIGZvciAobGV0IGk6IG51bWJlciA9IDA7IGkgPCBsZW4yOyBpICs9IG1heENodW5rTGVuZ3RoKSB7XG4gICAgICAgIGNodW5rRW5kID0gaSArIG1heENodW5rTGVuZ3RoO1xuICAgICAgICBwYXJ0c1tjdXJDaHVuaysrXSA9IGVuY29kZUNodW5rKFxuICAgICAgICAgIGJ1ZixcbiAgICAgICAgICBpLFxuICAgICAgICAgIGNodW5rRW5kID4gbGVuMiA/IGxlbjIgOiBjaHVua0VuZCxcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgbGV0IHRtcDogbnVtYmVyO1xuXG4gICAgICAvLyBQYWQgdGhlIGVuZCB3aXRoIHplcm9zLCBidXQgbWFrZSBzdXJlIHRvIG5vdCBmb3JnZXQgdGhlIGV4dHJhIGJ5dGVzXG4gICAgICBpZiAoZXh0cmFCeXRlcyA9PT0gMSkge1xuICAgICAgICB0bXAgPSBidWZbbGVuMl07XG4gICAgICAgIHBhcnRzW2N1ckNodW5rXSA9IGxvb2t1cFt0bXAgPj4gMl0gKyBsb29rdXBbKHRtcCA8PCA0KSAmIDB4M2ZdO1xuICAgICAgICBpZiAoIXVybHNhZmUpIHBhcnRzW2N1ckNodW5rXSArPSBcIj09XCI7XG4gICAgICB9IGVsc2UgaWYgKGV4dHJhQnl0ZXMgPT09IDIpIHtcbiAgICAgICAgdG1wID0gKGJ1ZltsZW4yXSA8PCA4KSB8IChidWZbbGVuMiArIDFdICYgMHhmZik7XG4gICAgICAgIHBhcnRzW2N1ckNodW5rXSA9IGxvb2t1cFt0bXAgPj4gMTBdICtcbiAgICAgICAgICBsb29rdXBbKHRtcCA+PiA0KSAmIDB4M2ZdICtcbiAgICAgICAgICBsb29rdXBbKHRtcCA8PCAyKSAmIDB4M2ZdO1xuICAgICAgICBpZiAoIXVybHNhZmUpIHBhcnRzW2N1ckNodW5rXSArPSBcIj1cIjtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHBhcnRzLmpvaW4oXCJcIik7XG4gICAgfSxcbiAgfTtcbn1cbiJdfQ==