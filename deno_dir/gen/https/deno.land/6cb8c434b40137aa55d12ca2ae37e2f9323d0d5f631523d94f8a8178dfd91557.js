import { Encodings } from "./_node.ts";
import { indexOf } from "../../bytes/mod.ts";
export function numberToBytes(n) {
    if (n === 0)
        return new Uint8Array([0]);
    const bytes = [];
    bytes.unshift(n & 255);
    while (n >= 256) {
        n = n >>> 8;
        bytes.unshift(n & 255);
    }
    return new Uint8Array(bytes);
}
function findLastIndex(targetBuffer, buffer, offset) {
    offset = offset > targetBuffer.length ? targetBuffer.length : offset;
    const searchableBuffer = targetBuffer.slice(0, offset + buffer.length);
    const searchableBufferLastIndex = searchableBuffer.length - 1;
    const bufferLastIndex = buffer.length - 1;
    let lastMatchIndex = -1;
    let matches = 0;
    let index = -1;
    for (let x = 0; x <= searchableBufferLastIndex; x++) {
        if (searchableBuffer[searchableBufferLastIndex - x] ===
            buffer[bufferLastIndex - matches]) {
            if (lastMatchIndex === -1) {
                lastMatchIndex = x;
            }
            matches++;
        }
        else {
            matches = 0;
            if (lastMatchIndex !== -1) {
                x = lastMatchIndex + 1;
                lastMatchIndex = -1;
            }
            continue;
        }
        if (matches === buffer.length) {
            index = x;
            break;
        }
    }
    if (index === -1)
        return index;
    return searchableBufferLastIndex - index;
}
function indexOfBuffer(targetBuffer, buffer, byteOffset, encoding, forwardDirection) {
    if (!Encodings[encoding] === undefined) {
        throw new Error(`Unknown encoding code ${encoding}`);
    }
    if (!forwardDirection) {
        if (byteOffset < 0) {
            byteOffset = targetBuffer.length + byteOffset;
        }
        if (buffer.length === 0) {
            return byteOffset <= targetBuffer.length
                ? byteOffset
                : targetBuffer.length;
        }
        return findLastIndex(targetBuffer, buffer, byteOffset);
    }
    if (buffer.length === 0) {
        return byteOffset <= targetBuffer.length ? byteOffset : targetBuffer.length;
    }
    return indexOf(targetBuffer, buffer, byteOffset);
}
function indexOfNumber(targetBuffer, number, byteOffset, forwardDirection) {
    const bytes = numberToBytes(number);
    if (bytes.length > 1) {
        throw new Error("Multi byte number search is not supported");
    }
    return indexOfBuffer(targetBuffer, numberToBytes(number), byteOffset, Encodings.UTF8, forwardDirection);
}
export default { indexOfBuffer, indexOfNumber };
export { indexOfBuffer, indexOfNumber };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVmZmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYnVmZmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDdkMsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBRTdDLE1BQU0sVUFBVSxhQUFhLENBQUMsQ0FBUztJQUNyQyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBQUUsT0FBTyxJQUFJLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFeEMsTUFBTSxLQUFLLEdBQUcsRUFBRSxDQUFDO0lBQ2pCLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO0lBQ3ZCLE9BQU8sQ0FBQyxJQUFJLEdBQUcsRUFBRTtRQUNmLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ1osS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7S0FDeEI7SUFDRCxPQUFPLElBQUksVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQy9CLENBQUM7QUFRRCxTQUFTLGFBQWEsQ0FDcEIsWUFBd0IsRUFDeEIsTUFBa0IsRUFDbEIsTUFBYztJQUVkLE1BQU0sR0FBRyxNQUFNLEdBQUcsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO0lBRXJFLE1BQU0sZ0JBQWdCLEdBQUcsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUN2RSxNQUFNLHlCQUF5QixHQUFHLGdCQUFnQixDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFDOUQsTUFBTSxlQUFlLEdBQUcsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFLMUMsSUFBSSxjQUFjLEdBQUcs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LTIwMjIgdGhlIERlbm8gYXV0aG9ycy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4gTUlUIGxpY2Vuc2UuXG5pbXBvcnQgeyBFbmNvZGluZ3MgfSBmcm9tIFwiLi9fbm9kZS50c1wiO1xuaW1wb3J0IHsgaW5kZXhPZiB9IGZyb20gXCIuLi8uLi9ieXRlcy9tb2QudHNcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIG51bWJlclRvQnl0ZXMobjogbnVtYmVyKTogVWludDhBcnJheSB7XG4gIGlmIChuID09PSAwKSByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoWzBdKTtcblxuICBjb25zdCBieXRlcyA9IFtdO1xuICBieXRlcy51bnNoaWZ0KG4gJiAyNTUpO1xuICB3aGlsZSAobiA+PSAyNTYpIHtcbiAgICBuID0gbiA+Pj4gODtcbiAgICBieXRlcy51bnNoaWZ0KG4gJiAyNTUpO1xuICB9XG4gIHJldHVybiBuZXcgVWludDhBcnJheShieXRlcyk7XG59XG5cbi8vIFRPRE8oU29yZW13YXIpXG4vLyBDaGVjayBpZiBvZmZzZXQgb3IgYnVmZmVyIGNhbiBiZSB0cmFuc2Zvcm0gaW4gb3JkZXIgdG8ganVzdCB1c2Ugc3RkJ3MgbGFzdEluZGV4T2YgZGlyZWN0bHlcbi8vIFRoaXMgaW1wbGVtZW50YXRpb24gZGlmZmVycyBmcm9tIHN0ZCdzIGxhc3RJbmRleE9mIGluIHRoZSBmYWN0IHRoYXRcbi8vIGl0IGFsc28gaW5jbHVkZXMgaXRlbXMgb3V0c2lkZSBvZiB0aGUgb2Zmc2V0IGFzIGxvbmcgYXMgcGFydCBvZiB0aGVcbi8vIHNldCBpcyBjb250YWluZWQgaW5zaWRlIG9mIHRoZSBvZmZzZXRcbi8vIFByb2JhYmx5IHdheSBzbG93ZXIgdG9vXG5mdW5jdGlvbiBmaW5kTGFzdEluZGV4KFxuICB0YXJnZXRCdWZmZXI6IFVpbnQ4QXJyYXksXG4gIGJ1ZmZlcjogVWludDhBcnJheSxcbiAgb2Zmc2V0OiBudW1iZXIsXG4pIHtcbiAgb2Zmc2V0ID0gb2Zmc2V0ID4gdGFyZ2V0QnVmZmVyLmxlbmd0aCA/IHRhcmdldEJ1ZmZlci5sZW5ndGggOiBvZmZzZXQ7XG5cbiAgY29uc3Qgc2VhcmNoYWJsZUJ1ZmZlciA9IHRhcmdldEJ1ZmZlci5zbGljZSgwLCBvZmZzZXQgKyBidWZmZXIubGVuZ3RoKTtcbiAgY29uc3Qgc2VhcmNoYWJsZUJ1ZmZlckxhc3RJbmRleCA9IHNlYXJjaGFibGVCdWZmZXIubGVuZ3RoIC0gMTtcbiAgY29uc3QgYnVmZmVyTGFzdEluZGV4ID0gYnVmZmVyLmxlbmd0aCAtIDE7XG5cbiAgLy8gSW1wb3J0YW50IHRvIGtlZXAgdHJhY2sgb2YgdGhlIGxhc3QgbWF0Y2ggaW5kZXggaW4gb3JkZXIgdG8gYmFja3RyYWNrIGFmdGVyIGFuIGluY29tcGxldGUgbWF0Y2hcbiAgLy8gTm90IGRvaW5nIHRoaXMgd2lsbCBjYXVzZSB0aGUgc2VhcmNoIHRvIHNraXAgYWxsIHBvc3NpYmxlIG1hdGNoZXMgdGhhdCBoYXBwZW5lZCBpbiB0aGVcbiAgLy8gbGFzdCBtYXRjaCByYW5nZVxuICBsZXQgbGFzdE1hdGNoSW5kZXggPSAtMTtcbiAgbGV0IG1hdGNoZXMgPSAwO1xuICBsZXQgaW5kZXggPSAtMTtcbiAgZm9yIChsZXQgeCA9IDA7IHggPD0gc2VhcmNoYWJsZUJ1ZmZlckxhc3RJbmRleDsgeCsrKSB7XG4gICAgaWYgKFxuICAgICAgc2VhcmNoYWJsZUJ1ZmZlcltzZWFyY2hhYmxlQnVmZmVyTGFzdEluZGV4IC0geF0gPT09XG4gICAgICAgIGJ1ZmZlcltidWZmZXJMYXN0SW5kZXggLSBtYXRjaGVzXVxuICAgICkge1xuICAgICAgaWYgKGxhc3RNYXRjaEluZGV4ID09PSAtMSkge1xuICAgICAgICBsYXN0TWF0Y2hJbmRleCA9IHg7XG4gICAgICB9XG4gICAgICBtYXRjaGVzKys7XG4gICAgfSBlbHNlIHtcbiAgICAgIG1hdGNoZXMgPSAwO1xuICAgICAgaWYgKGxhc3RNYXRjaEluZGV4ICE9PSAtMSkge1xuICAgICAgICAvLyBSZXN0YXJ0IHRoZSBzZWFyY2ggcmlnaHQgYWZ0ZXIgdGhlIGxhc3QgaW5kZXggd2FzIGlnbm9yZWRcbiAgICAgICAgeCA9IGxhc3RNYXRjaEluZGV4ICsgMTtcbiAgICAgICAgbGFzdE1hdGNoSW5kZXggPSAtMTtcbiAgICAgIH1cbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGlmIChtYXRjaGVzID09PSBidWZmZXIubGVuZ3RoKSB7XG4gICAgICBpbmRleCA9IHg7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBpZiAoaW5kZXggPT09IC0xKSByZXR1cm4gaW5kZXg7XG5cbiAgcmV0dXJuIHNlYXJjaGFibGVCdWZmZXJMYXN0SW5kZXggLSBpbmRleDtcbn1cblxuLy8gVE9ET1xuLy8gVGFrZSBlbmNvZGluZyBpbnRvIGFjY291bnQgd2hlbiBldmFsdWF0aW5nIGluZGV4XG5mdW5jdGlvbiBpbmRleE9mQnVmZmVyKFxuICB0YXJnZXRCdWZmZXI6IFVpbnQ4QXJyYXksXG4gIGJ1ZmZlcjogVWludDhBcnJheSxcbiAgYnl0ZU9mZnNldDogbnVtYmVyLFxuICBlbmNvZGluZzogRW5jb2RpbmdzLFxuICBmb3J3YXJkRGlyZWN0aW9uOiBib29sZWFuLFxuKSB7XG4gIGlmICghRW5jb2RpbmdzW2VuY29kaW5nXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIGVuY29kaW5nIGNvZGUgJHtlbmNvZGluZ31gKTtcbiAgfVxuXG4gIGlmICghZm9yd2FyZERpcmVjdGlvbikge1xuICAgIC8vIElmIG5lZ2F0aXZlIHRoZSBvZmZzZXQgaXMgY2FsY3VsYXRlZCBmcm9tIHRoZSBlbmQgb2YgdGhlIGJ1ZmZlclxuXG4gICAgaWYgKGJ5dGVPZmZzZXQgPCAwKSB7XG4gICAgICBieXRlT2Zmc2V0ID0gdGFyZ2V0QnVmZmVyLmxlbmd0aCArIGJ5dGVPZmZzZXQ7XG4gICAgfVxuXG4gICAgaWYgKGJ1ZmZlci5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBieXRlT2Zmc2V0IDw9IHRhcmdldEJ1ZmZlci5sZW5ndGhcbiAgICAgICAgPyBieXRlT2Zmc2V0XG4gICAgICAgIDogdGFyZ2V0QnVmZmVyLmxlbmd0aDtcbiAgICB9XG5cbiAgICByZXR1cm4gZmluZExhc3RJbmRleCh0YXJnZXRCdWZmZXIsIGJ1ZmZlciwgYnl0ZU9mZnNldCk7XG4gIH1cblxuICBpZiAoYnVmZmVyLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiBieXRlT2Zmc2V0IDw9IHRhcmdldEJ1ZmZlci5sZW5ndGggPyBieXRlT2Zmc2V0IDogdGFyZ2V0QnVmZmVyLmxlbmd0aDtcbiAgfVxuXG4gIHJldHVybiBpbmRleE9mKHRhcmdldEJ1ZmZlciwgYnVmZmVyLCBieXRlT2Zmc2V0KTtcbn1cblxuLy8gVE9ETyhTb3JlbXdhcilcbi8vIE5vZGUncyBpbXBsZW1lbnRhdGlvbiBpcyBhIHZlcnkgb2JzY3VyZSBhbGdvcml0aG0gdGhhdCBJIGhhdmVuJ3QgYmVlbiBhYmxlIHRvIGNyYWNrIGp1c3QgeWV0XG5mdW5jdGlvbiBpbmRleE9mTnVtYmVyKFxuICB0YXJnZXRCdWZmZXI6IFVpbnQ4QXJyYXksXG4gIG51bWJlcjogbnVtYmVyLFxuICBieXRlT2Zmc2V0OiBudW1iZXIsXG4gIGZvcndhcmREaXJlY3Rpb246IGJvb2xlYW4sXG4pIHtcbiAgY29uc3QgYnl0ZXMgPSBudW1iZXJUb0J5dGVzKG51bWJlcik7XG5cbiAgaWYgKGJ5dGVzLmxlbmd0aCA+IDEpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJNdWx0aSBieXRlIG51bWJlciBzZWFyY2ggaXMgbm90IHN1cHBvcnRlZFwiKTtcbiAgfVxuXG4gIHJldHVybiBpbmRleE9mQnVmZmVyKFxuICAgIHRhcmdldEJ1ZmZlcixcbiAgICBudW1iZXJUb0J5dGVzKG51bWJlciksXG4gICAgYnl0ZU9mZnNldCxcbiAgICBFbmNvZGluZ3MuVVRGOCxcbiAgICBmb3J3YXJkRGlyZWN0aW9uLFxuICApO1xufVxuXG5leHBvcnQgZGVmYXVsdCB7IGluZGV4T2ZCdWZmZXIsIGluZGV4T2ZOdW1iZXIgfTtcbmV4cG9ydCB7IGluZGV4T2ZCdWZmZXIsIGluZGV4T2ZOdW1iZXIgfTtcbiJdfQ==